# AI CODER RULES

**For full documentation, see [README.md](README.md).** This file contains quick-reference rules for AI coders.

## Project Overview

Open water swimming conditions app (shallweswim.today). Aggregates tide, current, and temperature data from NOAA/USGS APIs for multiple locations.

## Essential Commands

```bash
uv run pytest -v -k "not integration"   # Unit tests (default)
uv run mypy --config-file=pyproject.toml .  # Type checking
uv run pre-commit run --all-files       # All quality checks
uv run python -m shallweswim.main --port=12345  # Run locally
```

## Critical Rules

1. **Use uv for everything** - Never use pip, poetry, or bare python. Always `uv run <command>`.
2. **Run commands from repo root** - Don't cd into subdirectories.
3. **Run pre-commit after major changes** - Catches formatting, linting, and type errors.
4. **Don't run integration tests** unless explicitly requested - They hit live external APIs.
5. **Follow ARCHITECTURE.md strictly** - See [ARCHITECTURE.md](ARCHITECTURE.md) for architecture and coding standards.
6. **Never modify station configurations** - Do not change NOAA/USGS station IDs or data sources without explicit user approval. Configuration changes are out of scope.
7. **No AI attribution in commits** - Do not include "Co-Authored-By", "Generated by", or similar AI tool author mentions in commit messages or code comments.
8. **Never git commit without explicit user approval** - Always wait for the user to approve before running git commit.
9. **Keep documentation in sync** - Update README.md, ARCHITECTURE.md, and docstrings when implementing features, refactoring, or changing behavior. Commits should be atomic: include both code and documentation changes together.

## Architecture Quick Reference

```
API Handler → LocationDataManager → Feed → ApiClient → External Service
```

```
shallweswim/
├── main.py      # App entry, web UI routes
├── api.py       # JSON API routes (delegates to data.py)
├── data.py      # LocationDataManager coordinates feeds
├── feeds.py     # Feed classes with caching/expiration
├── config.py    # Location configs and station IDs
├── clients/     # Pure API clients (coops, ndbc, nwis)
└── plotting.py  # Chart generation (process pool)
```

## Before Implementing

- Check existing patterns in similar code before writing new code
- New locations: config.py → data.py → api.py → main.py → tests
- CPU-bound work (plotting): Must use process pool, not async
